<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Documentation &mdash; PhyloJunction 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/css/pj_custom.css?v=b916aa57" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="phylojunction" href="../modules.html" />
    <link rel="prev" title="Installing and configuring PhyloJunction" href="../installing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/pj_logo_doc.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#origins-and-design">Origins and design</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphical-models">Graphical models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-read-a-dag">How to read a DAG?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#specifying-a-model-an-example">Specifying a model (an example)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#multiple-samples-and-replicates">Multiple samples and replicates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#graphical-user-interface-gui">Graphical user interface (GUI)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implementation-comparison">Implementation comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coverage-validation">Coverage validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-interface-cli">Command-line interface (CLI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bypassing-the-interfaces">Bypassing the interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lexicon">Lexicon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parametric-distributions">Parametric distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#uniform">Uniform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exponential">Exponential</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gamma">Gamma</a></li>
<li class="toctree-l4"><a class="reference internal" href="#normal">Normal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#log-normal">Log-normal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tree-distributions">Tree distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#discrete-sse">Discrete SSE</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Library API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PhyloJunction</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pjdoc/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="documentation">
<h1>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id17">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#origins-and-design" id="id18">Origins and design</a></p></li>
<li><p><a class="reference internal" href="#graphical-models" id="id19">Graphical models</a></p>
<ul>
<li><p><a class="reference internal" href="#how-to-read-a-dag" id="id20">How to read a DAG?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#specifying-a-model-an-example" id="id21">Specifying a model (an example)</a></p>
<ul>
<li><p><a class="reference internal" href="#multiple-samples-and-replicates" id="id22">Multiple samples and replicates</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#graphical-user-interface-gui" id="id23">Graphical user interface (GUI)</a></p>
<ul>
<li><p><a class="reference internal" href="#implementation-comparison" id="id24">Implementation comparison</a></p></li>
<li><p><a class="reference internal" href="#coverage-validation" id="id25">Coverage validation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#command-line-interface-cli" id="id26">Command-line interface (CLI)</a></p></li>
<li><p><a class="reference internal" href="#bypassing-the-interfaces" id="id27">Bypassing the interfaces</a></p></li>
<li><p><a class="reference internal" href="#lexicon" id="id28">Lexicon</a></p>
<ul>
<li><p><a class="reference internal" href="#parametric-distributions" id="id29">Parametric distributions</a></p>
<ul>
<li><p><a class="reference internal" href="#uniform" id="id30">Uniform</a></p></li>
<li><p><a class="reference internal" href="#exponential" id="id31">Exponential</a></p></li>
<li><p><a class="reference internal" href="#gamma" id="id32">Gamma</a></p></li>
<li><p><a class="reference internal" href="#normal" id="id33">Normal</a></p></li>
<li><p><a class="reference internal" href="#log-normal" id="id34">Log-normal</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tree-distributions" id="id35">Tree distributions</a></p>
<ul>
<li><p><a class="reference internal" href="#discrete-sse" id="id36">Discrete SSE</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<section id="origins-and-design">
<h3>Origins and design<a class="headerlink" href="#origins-and-design" title="Link to this heading"></a></h3>
<p>The PhyloJunction project was born from our need to simulate arbitrarily complex SSE processes, but not being able to do so with many existing applications.
A series of related diversification models had been implemented in excellent computational methods, but each of those tools made unique modeling assumptions that we wanted to relax.</p>
<p>Instead of reverse-engineering and modifying code written by others, however, it seemed like the path of least resistance was to write our own simulator.
We also realized that our program could potentially come in handy in multiple projects, current and future, though only if written as more than a “one-off” chunk of code.</p>
<p>Ideally, PhyloJunction would have to be “modular” in its architecture, both in terms of its codebase as well as how models should be represented and specified.
This modularity would allow future models to be more easily implemented – potentially by other developers – and seamlessly patched into PhyloJunction.</p>
<p>With the above in mind, we reasoned our work would be more likely to bear fruits (and faster) if we used a programming language that:</p>
<blockquote>
<div><ol class="lowerroman simple">
<li><p>was easy to prototype and debug model code in, and</p></li>
<li><p>cross-platform,</p></li>
<li><p>supported object-oriented programming, and for which</p></li>
<li><p>biology and data-science libraries were available.</p></li>
</ol>
</div></blockquote>
<p>Python was our language of choice.
As for item (4), for example, we could make heavy use of the great <a class="reference external" href="https://dendropy.org/" rel="noopener noreferrer" target="_blank">Dendropy</a> library, maintained by Jeet Sukumaran and collaborators.</p>
<p>Modularity was achieved by building PhyloJunction around a graphical modeling architecture.
This design (used in the past, see below) would not only make PhyloJunction a more flexible simulator, but also more generally useful in the future, as a tool for method development and inference.</p>
</section>
<section id="graphical-models">
<h3>Graphical models<a class="headerlink" href="#graphical-models" title="Link to this heading"></a></h3>
<p>PhyloJunction follows the graphical model paradigm popularized in the last decade by programs like <a class="reference external" href="https://revbayes.github.io/" rel="noopener noreferrer" target="_blank">RevBayes</a>, <a class="reference external" href="https://beast.community/" rel="noopener noreferrer" target="_blank">BEAST</a> and <a class="reference external" href="https://www.beast2.org/" rel="noopener noreferrer" target="_blank">BEAST 2</a>.
In what follows, we shall offer just a brief refresher on what probabilistic graphical models are, and one simple example of their use in evolutionary modeling.
Those interested in a more detailed exposition will find it in Höhna et al. (2014) and references therein (also, take a look <a class="reference external" href="https://revbayes.github.io/tutorials/intro/graph_models.html" rel="noopener noreferrer" target="_blank">here</a>).</p>
<p>Just as with the RevBayes and BEAST programs, specifying a model in PhyloJunction amounts to writing down any number of conditional dependencies among random variables.
When looked at collectively, random variables comprise a type of probabilistic graphical model called a Bayesian network.
As the name suggest, such models can be described as graphs – directed acyclic graphs (<strong>DAG</strong>), more specifically – where each node (or vertex) represents a random variable, and each edge a conditional dependency between the two nodes (variables) it connects.</p>
<p>A Bayesian network representing a very simple model can be seen in figure 1a:</p>
<figure class="align-center" id="id2" style="width: 100%">
<a class="reference internal image-reference" href="../_images/simple_graphical_model_both_manual.png"><img alt="../_images/simple_graphical_model_both_manual.png" src="../_images/simple_graphical_model_both_manual.png" style="width: 436.40000000000003px; height: 216.8px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Figure 1.</strong> A simple probabilistic model represented by (a) a Bayesian network, and (b) a factor graph.
From the notation in the main text, <span class="math notranslate nohighlight">\(\theta=\{sd, m\}\)</span>.
The dashed box is called a “plate”, and for each node it envelops it denotes multiple (in this case, precisely five) i.i.d. random variables.
White and gray nodes denote random variables whose values we do (i.e., data) and do not know (i.e., parameters), respectively.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>If we were to pen down what this Bayesian network represents in probability terms, we would arrive at a joint density (assuming continuous variables) given by expression:</p>
<div class="math notranslate nohighlight" id="equation-jointprob">
<span class="eqno">(1)<a class="headerlink" href="#equation-jointprob" title="Link to this equation"></a></span>\[f_{\Theta,D}(\theta,d) = f_{\Theta|D}(\theta|D=d)f_D(d) = f_{D|\Theta}(d|\Theta=\theta)f_\Theta(\theta),\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta=\{sd, m\}\)</span>.</p>
<p>By comparing the Bayesian network graph and the expression above, the attentive reader will notice that functions are not represented in the graph.
We do not know exactly how random variables are related, other than <span class="math notranslate nohighlight">\(d_1\)</span> through <span class="math notranslate nohighlight">\(d_5\)</span> depending somehow on <span class="math notranslate nohighlight">\(sd\)</span> and <span class="math notranslate nohighlight">\(m\)</span>.
This is why it can be helpful to adopt a more general graphical representation: a factor graph (Fig. 1b).</p>
<p>The model underlying the factor graph in figure 1b is the same as that shown by the Bayesian network, the main difference being the additional factor nodes (the filled squares).
Factor nodes can make the relationships between two or more random variables more explicit, especially if their (factor) functions are annotated.</p>
<p>In the example above we can see a factor whose function <span class="math notranslate nohighlight">\(f_{D|\Theta}(d|\Theta=\theta)\)</span> gives us the probability of <span class="math notranslate nohighlight">\(\boldsymbol{d} = \{d_i: 1 \leq i \leq n\}\)</span> given <span class="math notranslate nohighlight">\(\theta\)</span>.
It is annotated as “Normal”, so we in fact know a close-form expression for this factor function; it is the probability density function of a normal distribution.
Random variables <span class="math notranslate nohighlight">\(sd\)</span> and <span class="math notranslate nohighlight">\(m\)</span> stand for the standard deviation and the mean of that normal distribution.
(For those curious to see just how complicated factor graphs can be, an example can be found in Zhang et al., 2023; see their Supplementary Fig. X.)</p>
<section id="how-to-read-a-dag">
<h4>How to read a DAG?<a class="headerlink" href="#how-to-read-a-dag" title="Link to this heading"></a></h4>
<p>Most biologists specifying a DAG on a computer do so as the first step of statistical <strong>inference</strong>.
They are interested in estimating unknown quantities about the natural world.
These quantities – the random variables! – whose values we do not know (but would like to estimate) are referred to as the <strong>parameters</strong> of the model.
Of course, parameter estimation requires that we know the value(s) of one or more random variables, which we naturally refer to as <strong>data</strong>.</p>
<p>In the example in figure 1, the parameters are <span class="math notranslate nohighlight">\(sd\)</span> and <span class="math notranslate nohighlight">\(m\)</span>, jointly referred to as <span class="math notranslate nohighlight">\(\theta\)</span>; the data is node labeled <span class="math notranslate nohighlight">\(d_i\)</span>.
(Note how they are colored differently, gray for data, white for parameter.)
Carrying out statistical inference thus implies reading the DAG from its data nodes, normally at the bottom, towards the parameter nodes above.</p>
<p>The most natural approach to parameter estimation requires that we simply take the middle and right-hand side terms in equation <a class="reference internal" href="#equation-jointprob">(1)</a>,
and solve for <span class="math notranslate nohighlight">\(f_{\Theta|D}(\theta|D=d)\)</span>, the posterior density function:</p>
<div class="math notranslate nohighlight" id="equation-bayestheorem">
<span class="eqno">(2)<a class="headerlink" href="#equation-bayestheorem" title="Link to this equation"></a></span>\[f_{\Theta|D}(\theta|D=d) = \frac{f_{D|\Theta}(d|\Theta=\theta)f_\Theta(\theta)}{f_D(d)}\]</div>
<p>This expression is known as Bayes theorem.
What programs like RevBayes, BEAST and BEAST 2 do is evaluate the posterior density function at several values of <span class="math notranslate nohighlight">\(\theta\)</span>, and output the resulting (posterior) distribution.</p>
<hr class="docutils" />
<p>PhyloJunction, however, is among other things a collection of <strong>simulation</strong> (rather than estimation) engines.
Borrowing the jargon used above, we are primarily interested in generating values for random variables, some of which are parameters, some data.</p>
<p>Here, it makes sense to think of factors as the distributions from which values will be sampled (though as we will see below, factors can also represent deterministic functions).
As opposed to estimation, simulation starts at the top (or “outer”) layers of the DAG, from parameters whose values we do know, and flows in the direction pointed to by arrows (normally downwards; Fig. 1b).</p>
<p>In figure 1b, for example, we start from known values for the parameters of the distributions at the top.
The exponential distribution from which we sample (i.e., simulate) <span class="math notranslate nohighlight">\(sd\)</span> has a rate of 1.0; the standard normal distribution (<span class="math notranslate nohighlight">\(Z\)</span>) from which we sample <span class="math notranslate nohighlight">\(m\)</span>, by definition, has a mean of 0.0 and a standard deviation of 1.0.
We then define a normal distribution from the sampled values of <span class="math notranslate nohighlight">\(sd\)</span> and <span class="math notranslate nohighlight">\(m\)</span>, and in turn sample five times from that normal distribution, obtaining our data values in <span class="math notranslate nohighlight">\(\boldsymbol{d}\)</span>.</p>
</section>
</section>
<section id="specifying-a-model-an-example">
<h3>Specifying a model (an example)<a class="headerlink" href="#specifying-a-model-an-example" title="Link to this heading"></a></h3>
<p>PhyloJunction takes a model specification approach that sits between those adopted by the BEAST and RevBayes communities, and that largely intersects with the <a class="reference external" href="https://linguaphylo.github.io/" rel="noopener noreferrer" target="_blank">LinguaPhylo</a> project.
DAG-building instructions in PhyloJunction are written in its own programming language, <em>phylojunction</em> (written in lowercase), whose syntax evokes RevBayes’ Rev language.
But unlike Rev, <em>phylojunction</em> is not a fully fledged scripting language; it is lightweight and behaves more like a markup language such as XML, BEAST’s format of choice.</p>
<p>Commands in <em>phylojunction</em> can be read as mathematical statements, and are naturally interpreted as instructions for building a node in a DAG.
Here is what a series of those commands would look like if written as a <em>phylojunction</em> script:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><strong>Example script 1.</strong> Script written in <em>phylojunction</em> specifying a time-homogenous birth-death model.</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># hyperprior</span>
<span class="n">m</span> <span class="o">&lt;-</span> <span class="mf">0.0</span> <span class="c1"># mean of log-normal below</span>
<span class="n">sd</span> <span class="o">&lt;-</span> <span class="mf">0.1</span> <span class="c1"># standard deviation of log-normal below</span>

<span class="c1"># rate values</span>
<span class="n">d</span> <span class="o">&lt;-</span> <span class="mf">1.0</span> <span class="c1"># death</span>
<span class="n">b</span> <span class="o">~</span> <span class="n">lognormal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="p">)</span> <span class="c1"># birth</span>

<span class="c1"># deterministic rate containers</span>
<span class="n">dr</span> <span class="o">:=</span> <span class="n">sse_rate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;death_rate&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;extinction&quot;</span><span class="p">)</span>
<span class="n">br</span> <span class="o">:=</span> <span class="n">sse_rate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;birth_rate&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;speciation&quot;</span><span class="p">)</span>

<span class="n">O</span> <span class="o">&lt;-</span> <span class="mf">2.0</span> <span class="c1"># origin age</span>

<span class="c1"># deterministic parameter stash</span>
<span class="n">s</span> <span class="o">:=</span> <span class="n">sse_stash</span><span class="p">(</span><span class="n">flat_rate_mat</span><span class="o">=</span><span class="p">[</span><span class="n">dr</span><span class="p">,</span> <span class="n">br</span><span class="p">],</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># parameter stash</span>

<span class="c1"># phylogenetic tree</span>
<span class="n">T</span> <span class="o">~</span> <span class="n">discrete_sse</span><span class="p">(</span><span class="n">stash</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">stop_value</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Each line in the above script is a command instructing the application engine to take some form of user input, produce some value from it, and then store that value permanently in a new variable created on the spot.</p>
<p>Every command string consists of an assignment operator (e.g., <code class="docutils literal notranslate"><span class="pre">&lt;-</span></code>, <code class="docutils literal notranslate"><span class="pre">:=</span></code>, <code class="docutils literal notranslate"><span class="pre">~</span></code>) placed between the variable being created (on its left side) and some user input (on its right side).
We can look at some of these commands individually:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">&lt;-</span> <span class="pre">1.0</span></code> creates a variable <code class="docutils literal notranslate"><span class="pre">d</span></code> (the death rate) that is then passed and henceforth stores constant value <code class="docutils literal notranslate"><span class="pre">1.0</span></code>. We use <code class="docutils literal notranslate"><span class="pre">&lt;-</span></code> when we know the value of a random variable and want to create a constant node in the DAG;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">~</span> <span class="pre">lognormal(mean=m,</span> <span class="pre">sd=sd)</span></code> creates a variable <code class="docutils literal notranslate"><span class="pre">b</span></code> (the birth rate) that will store a random value drawn from a user-specified distribution. Here, that distribution is a log-normal with mean <cite>m</cite> and standard deviation <cite>sd</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dr</span> <span class="pre">:=</span> <span class="pre">sse_rate(name=&quot;death_rate&quot;,</span> <span class="pre">value=d,</span> <span class="pre">event=&quot;extinction&quot;)</span></code> calls deterministic function <code class="docutils literal notranslate"><span class="pre">sse_rate</span></code>, which creates variable <code class="docutils literal notranslate"><span class="pre">dr</span></code> from the value stored in <code class="docutils literal notranslate"><span class="pre">d</span></code> and some other user input. There is no stochasticity to deterministic assignments; they help make explicit steps where variables are transformed, annotated or combined with others.</p></li>
</ul>
<p>And this is the DAG such script instantiates:</p>
<figure class="align-center" id="id4" style="width: 100%">
<a class="reference internal image-reference" href="../_images/bd_graphical_model_manual.png"><img alt="../_images/bd_graphical_model_manual.png" src="../_images/bd_graphical_model_manual.png" style="width: 257.6px; height: 458.40000000000003px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Figure 2.</strong> Factor graph representing the time-homogenous birth-death model specified in example script 1.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Note how this DAG has a factor node characterized by a different type of function: deterministic function <code class="docutils literal notranslate"><span class="pre">sse_rate</span></code>.
Such functions are denoted by filled diamonds instead of filled squares (those represent distributions), and will have their output enclosed in a hollow diamond.</p>
<section id="multiple-samples-and-replicates">
<h4>Multiple samples and replicates<a class="headerlink" href="#multiple-samples-and-replicates" title="Link to this heading"></a></h4>
<p>Unlike other probabilistic programming languages, in <em>phylojunction</em> the output of every function is immutable and depends exclusively on that function’s input.
Initialized variables cannot be altered by mutator methods or side-effects.</p>
<p>An important consequence of variable immutability is that it precludes loop control structures (e.g., <em>for</em> and <em>while</em> loops).
A reasonable question is then: <em>How does one have the model be sampled (i.e., simulated) multiple times?</em></p>
<p>Let us look at the simple model shown in figure 1.
Ten independent samples of that model can be obtained with following <em>phylojunction</em> script:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><strong>Example script 2.</strong> Script written in <em>phylojunction</em> specifying the simple model in figure 1 and sampling (i.e., simulating) it ten times.</span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd</span> <span class="o">~</span> <span class="n">exponential</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># this value will be vectorized</span>
<span class="n">m</span> <span class="o">~</span> <span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="c1"># ... and so will this!</span>
<span class="n">d</span> <span class="o">~</span> <span class="n">normal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As can be seen from the last line in script 2, all it took was providing argument <code class="docutils literal notranslate"><span class="pre">n=10</span></code> to the function call of a distribution.
But note how the first and second lines in script 2 do not set <code class="docutils literal notranslate"><span class="pre">n=10</span></code>.
There is just a single value being drawn from exponential and standard normal distributions; implicitly, those commands are setting <code class="docutils literal notranslate"><span class="pre">n=1</span></code>.</p>
<p>PhyloJunction deals with this discrepancy in the requested number of samples by <strong>vectorizing</strong> the single values stored in <span class="math notranslate nohighlight">\(sd\)</span> and <span class="math notranslate nohighlight">\(m\)</span>.
For example, if the sampled value of <span class="math notranslate nohighlight">\(m\)</span> is 0.1, under the hood PhyloJunction converts <span class="math notranslate nohighlight">\(m=1.0\)</span> into <span class="math notranslate nohighlight">\(\boldsymbol{m}=\{0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1\}\)</span>.
In such case, all ten samples requested by command <code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">~</span> <span class="pre">normal(n=10,</span> <span class="pre">nr=5,</span> <span class="pre">mean=m,</span> <span class="pre">sd=sd)</span></code> would thus come from normal distributions with the same mean of 0.1.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PhyloJunction will raise an error if the number of samples <code class="docutils literal notranslate"><span class="pre">n</span></code> specified in two commands are both different and greater than 1.
In other words, vectorization can only be applied on variables holding a single value.
(This type of behavior should be familiar to R users.)</p>
</div>
<hr class="docutils" />
<p>In addition to simulating an entire model multiple times as explained above, it is also possible to specify a model with multiple i.i.d. random variables, alternatively referred to as <strong>replicates</strong>.
Multiple replicates can be specified by providing an additional argument <code class="docutils literal notranslate"><span class="pre">nr</span></code> to distribution calls, e.g., <code class="docutils literal notranslate"><span class="pre">nr=5</span></code> as in the last line of script 2.</p>
<p>In a DAG, i.i.d. random variables can be collectively represented by a single plated node (Fig. 1), or each be represented by an individual node.
There are in principle no constraints on the number of replicates a plated node may represent.
Errors will be thrown only if such nodes are used as input for a function, and the replicate count somehow violates that function’s signature.</p>
</section>
</section>
</section>
<section id="graphical-user-interface-gui">
<h2>Graphical user interface (GUI)<a class="headerlink" href="#graphical-user-interface-gui" title="Link to this heading"></a></h2>
<p id="gui">PhyloJunction comes with a (simple!) graphical user interface (GUI; see Fig. 3) that allows users to incrementally build a model while simultaneously inspecting any simulation output (among other things).</p>
<figure class="align-center" id="id6" style="width: 100%">
<img alt="../_images/pjgui_model.png" src="../_images/pjgui_model.png" />
<figcaption>
<p><span class="caption-text"><strong>Figure 3.</strong> PhyloJunction’s GUI main window.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Like any modern computer application, PhyloJunction’s GUI exposes its features to users via a menu (Fig. 3, number 2).
On the main tab (“Model”), one can build a model (DAG) with commands entered in the prompt (Fig. 3, number 1), or by loading a <em>phylojunction</em> script or a model from a previous PhyloJunction section.
The latter can be done by clicking the application’s menu (top-left corner of the Desktop on Apple machines), and clicking “File &gt; Read script” or “File &gt; Load model”.
Model building commands can be revisited by going into the menu’s “Command log” tab.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If mistakes are made when entering a command, PhyloJunction will flash a “Warning produced” message in red, at the bottom of the main window.
The warning message can be seen by visiting the “Warnings” tab.</p>
</div>
<p>Given a model, DAG node values can be navigated as a plot, text string, or both (Fig. 3, numbers 3 and 4).
Users can cycle through replicated simulations (Fig. 3, number 5), and examine node-value summaries computed for individual simulations or across replicates (Fig. 3, number 6).
Node-value summaries include the mean and standard deviation for scalar variables, and statistics like the root age and number of tips for phylogenetic trees.</p>
<p>After a model is specified, saving the main plot (from the “Model” tab) to disk can be done by clicking “Save plot as”.
Simulated data tables, or the model itself, in turn, can be saved to disk by clicking the application menu (top menu), and clicking “File &gt; Save data as” or “File &gt; Save model as”.</p>
<section id="implementation-comparison">
<h3>Implementation comparison<a class="headerlink" href="#implementation-comparison" title="Link to this heading"></a></h3>
<p>The “Compare” tab (under “Model”) streamlines the comparison of PhyloJunction’s simulations with those from an external simulator, with respect to a summary statistic.
There are two main moments when carrying out this type of comparison may be useful or required.
The first is when a model is being first implemented in PhyloJunction, and there happens to exist an independent implementation elsewhere.
This latter implementation can be used to provide a baseline expectation for PhyloJunction.</p>
<p>Beyond model development within the platform, the “Compare” tab was further designed to expedite activities related to teaching.
Students in an evolutionary modeling course may be asked to code their own Yule model, for example, in whatever programming language.
After Yule trees are obtained, all they need to do is collect summary statistics that are also monitored by PhyloJunction (e.g., the root age), and upload them into the “Compare” tab.
PhyloJunction then automatically plots the two distributions (one from the student, one from PhyloJunction itself) side by side, revealing if implementations behave similarly.</p>
<p>In order to use the functionalities exposed by the “Compare” tab, first one must to build a model in PhyloJunction.
We can start with the simple model in <a class="reference external" href="https://raw.githubusercontent.com/fkmendes/PhyloJunction/main/examples/multiple_scalar_tree_plated.pj" rel="noopener noreferrer" target="_blank">examples/multiple_scalar_tree_plated.pj</a>.
As the name suggests, this model has a few different scalar and tree random variables, some of them plated.
We can load it by clicking “File &gt; Read script” and selecting the aforementioned file.
By navigating to the “Compare” tab, you will see that PhyloJunction has loaded the DAG nodes that could potentially be compared on the left-hand “Nodes to compare” menu.</p>
<p>In the “Compare” tab, now click “Compare to .csv (…)”.
This button allows user to input a .csv file containing summary statistics computed from external simulations.
We will choose file <a class="reference external" href="https://raw.githubusercontent.com/fkmendes/PhyloJunction/main/examples/compare_files/comparison_multiple_scalar_tree_plated_rv5.csv" rel="noopener noreferrer" target="_blank">examples/compare_files/comparison_multiple_scalar_tree_plated_rv5.csv</a>.
Once the .csv file is loaded, PhyloJunction should display the contents of it in the top window.</p>
<figure class="align-center" id="id7" style="width: 100%">
<img alt="../_images/pjgui_compare.png" src="../_images/pjgui_compare.png" />
<figcaption>
<p><span class="caption-text"><strong>Figure 4.</strong> PhyloJunction’s GUI “Compare” tab.</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Note the “rv5” column name at header of the table – these are the variable names that PhyloJunction will try to look up (and compare with) in its own model’s list of nodes.
Accordingly, select “rv5” from the top-left “Node to compare” menu.
Now we are ready to draw, click “Draw”.
The produced graph (Fig. 4) should indicate that PhyloJunction and the external simulator behave similarly.</p>
<p>Let us now try a different random variable, a tree this time: click on node “trs2” on the “Node to compare” menu.
Because tree space is complicated (there are both a discrete and a continuous dimensions to it, the topology and branch lengths, respectively), we will need to look at tree summary statistics.
Different tree statistics should have been listed in the bottom-left “Summary statistics” menu.
Choose one of them, “root age”, for example.</p>
<p>Now we must then load a different .csv file, <a class="reference external" href="https://raw.githubusercontent.com/fkmendes/PhyloJunction/main/examples/compare_files/comparison_multiple_scalar_tree_plated_trs2.csv" rel="noopener noreferrer" target="_blank">examples/compare_files/comparison_multiple_scalar_tree_plated_trs2.csv</a>.
This file contains tree summary statistics presumably produced by a different external simulator.
Click “Draw”.
Again, the produced graph suggests the model implemented in both simulators behave similarly.</p>
</section>
<section id="coverage-validation">
<h3>Coverage validation<a class="headerlink" href="#coverage-validation" title="Link to this heading"></a></h3>
<p>The “Coverage” tab was developed for automating coverage validation, a procedure for verifying the correctness of a model implemented within a Bayesian framework.
Coverage validation in fact validates multiple things simultaneously: the generating (simulator) and inferential implementations of the model, and any machinery used in inference (e.g., MCMC proposals).
For the sake of clarity and conciseness, we will assume in this section that we are validating a model’s inferential engine, and that all other involved code works as intended.</p>
<p>The gist of coverage validation is straightforward: the <span class="math notranslate nohighlight">\(\alpha\)</span> %-HPD over a model parameter produced during Bayesian inference should contain the “true” (i.e., simulated) parameter value approximately <span class="math notranslate nohighlight">\(\alpha\)</span> % of the time.
For example, if a stochastic node in the DAG is sampled 100 times (i.e., 100 i.i.d. random variables), then for approximately 95 of those simulations the 95%-HPD interval will contain the true sampled value.</p>
<p>In order to carry out coverage validation with the GUI, first we must build a model in PhyloJunction.
Click “File &gt; Read script” and select <a class="reference external" href="https://raw.githubusercontent.com/fkmendes/PhyloJunction/main/examples/coverage_files/r_b_exp.pj" rel="noopener noreferrer" target="_blank">examples/coverage_files/r_b_exp.pj</a>.
In the loaded model, one hundred independent samples for a parameter <span class="math notranslate nohighlight">\(r_b\)</span> were assigned to a constant node <code class="docutils literal notranslate"><span class="pre">r_b</span></code> named after it.
These 100 values were drawn from an exponential distribution implemented elsewhere, but could also have been sampled directly in PhyloJunction.</p>
<p>In the “Coverage” tab, one can now load a .csv file containing a table with <span class="math notranslate nohighlight">\(r_b\)</span> ‘s posterior distribution’s mean value, and the lower and upper bounds of an HPD interval.
(This posterior distribution came from a Bayesian analysis done with a different program.)
The table headers must be <code class="docutils literal notranslate"><span class="pre">posterior_mean</span></code>, <code class="docutils literal notranslate"><span class="pre">lower_95hpd</span></code>, and <code class="docutils literal notranslate"><span class="pre">higher_95hpd</span></code>.
Click “Read HPDs .csv (…)”, and select <a class="reference external" href="https://raw.githubusercontent.com/fkmendes/PhyloJunction/main/examples/coverage_files/r_b_exp.csv" rel="noopener noreferrer" target="_blank">examples/coverage_files/r_b_exp.csv</a>.
The table should have been shown in the top middle window.</p>
<figure class="align-center" id="id8" style="width: 100%">
<img alt="../_images/pjgui_coverage.png" src="../_images/pjgui_coverage.png" />
<figcaption>
<p><span class="caption-text"><strong>Figure 5.</strong> PhyloJunction’s GUI “Coverage” tab.</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>To inspect coverage, select “r_b” from the top-left menu “Non-det. nodes”, and then click on “Draw”.
The x- and y-axes in the plot (the main panel in Fig. 5) show to the true simulated values and the posterior means, respectively.
Vertical bars denote the 95%-HPDs over <span class="math notranslate nohighlight">\(r_b\)</span>, with blue bars (95 of them) indicating intervals containing the true value, and red bars (5 of them) not containing it.
In other words, one can deduce from the graph that coverage for <span class="math notranslate nohighlight">\(r_b\)</span> was 0.95 (though this is also shown in the top-right panel; Fig. 5); this coverage is adequate and indicative of a correctly implemented model.</p>
<p>In addition to loading a .csv file with pre-calculated posterior distribution summaries, users can also tell PhyloJunction the path of a directory containing MCMC output .log files.
After loading the same model as before and clicking on “r_b” in the top-left menu, click on “Directory to .log’s (…)”, and choose <cite>examples/coverage_files/logfiles/</cite>.
If in the .log files the node being examined were to be named something different from “r_b”, users can tell PhyloJunction what to look for by entering the alternative name in “Parameter name in .log”.
For example, one could type “r_b” in “Parameter name in .log” (in this case it is not necessary).</p>
<p>Now click on “Draw”.
An almost identical plot should have been produced, and coverage is again appropriate (0.94).
(The difference of 1 in coverage has to do with the behavior of different libraries when computing HPD boundaries.)</p>
</section>
</section>
<section id="command-line-interface-cli">
<h2>Command-line interface (CLI)<a class="headerlink" href="#command-line-interface-cli" title="Link to this heading"></a></h2>
<p id="cli">PhyloJunction has a command-line interface (CLI) as an entry point for some of its functionalities – it is particularly handy when running PhyloJunction is a step in a longer pipeline (perhaps being run on a cluster).
The easiest way to see what is possible with the CLI is to call it on the Terminal with the <code class="docutils literal notranslate"><span class="pre">-h</span></code> flag, like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pjcli<span class="w"> </span>-h
</pre></div>
</div>
<p>The help message should list a series of flags, which we expand on below:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">-d</span></code>: Simulated data tables are written to disk.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-f</span></code>: Plots for the selected DAG nodes (whose names and sample ranges are passed as arguments) are written to disk. The argument for <code class="docutils literal notranslate"><span class="pre">-f</span></code> should be passed within single-quotes, e.g., ‘birth_rate,trs;1-2,1-10’.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-o</span></code>: Directory where to place simulated data tables and figures.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-p</span></code>: Prefix to prepend output files with (e.g., “simulation1”)</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-nex</span></code>: Certain simulated data is written to disk in NEXUS format.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-r</span></code>: Random seed so that simulations always produce the same output.</div>
</div>
</div></blockquote>
<p>Note that if no argument is passed to <code class="docutils literal notranslate"><span class="pre">-o</span></code>, data tables written to disk (prompted by <code class="docutils literal notranslate"><span class="pre">-d</span></code>) will be placed in the directory from which PhyloJunction is called.
Figures (prompted by <code class="docutils literal notranslate"><span class="pre">-f</span></code>), in turn, will be placed in a “figures/” sub-directory, next to the data tables.</p>
</section>
<section id="bypassing-the-interfaces">
<h2>Bypassing the interfaces<a class="headerlink" href="#bypassing-the-interfaces" title="Link to this heading"></a></h2>
</section>
<section id="lexicon">
<span id="bypass"></span><h2>Lexicon<a class="headerlink" href="#lexicon" title="Link to this heading"></a></h2>
<section id="parametric-distributions">
<h3>Parametric distributions<a class="headerlink" href="#parametric-distributions" title="Link to this heading"></a></h3>
<p>PhyloJunction ships with a (growing) number of parametric distributions.
All distributions support replication (i.e., plating in the DAG) and take as arguments both direct scalar values (e.g., “1.0”) and values stored in DAG nodes.
On this page you will find examples of how to invoke the available distributions (using the <em>phylojunction</em> language) when building a model.</p>
<section id="uniform">
<h4>Uniform<a class="headerlink" href="#uniform" title="Link to this heading"></a></h4>
<p>The function for assigning a uniform (<code class="docutils literal notranslate"><span class="pre">uniform</span></code>) distribution to a variable has four parameters:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">n</span></code> (integer, optional): Number of samples to draw (samples are i.i.d.). Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nr`</span></code> (integer, optional): Number of replicates to draw per sample. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">min</span></code> (real number, required): Lower bound (inclusive).</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">max</span></code> (real number, required): Upper bound (inclusive).</div>
</div>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><strong>Example command.</strong> Specifying two samples of a twice replicated uniformly distributed random variable <span class="math notranslate nohighlight">\(x\)</span>, from -1.0 and 1.0.</span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">~</span> <span class="n">unif</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="exponential">
<h4>Exponential<a class="headerlink" href="#exponential" title="Link to this heading"></a></h4>
<p>The function for assigning a exponential (<code class="docutils literal notranslate"><span class="pre">exponential</span></code>) distribution to a variable has four parameters:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">n</span></code> (integer, optional): Number of samples to draw (samples are i.i.d.). Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nr</span></code> (integer, optional): Number of replicates to draw per sample. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">rate</span></code> (positive real, required): Rate (or scale) of distribution.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">rate_parameterization</span></code> (string boolean, optional): Whether the value passed in <code class="docutils literal notranslate"><span class="pre">rate</span></code> is the distribution’s rate. Defaults to “true”.</div>
</div>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><strong>Example command.</strong> Specifying two samples of a twice replicated exponentially (scale <span class="math notranslate nohighlight">\(\frac{1}{\lambda}=1.0\)</span>) distributed random variable <span class="math notranslate nohighlight">\(x\)</span>.</span><a class="headerlink" href="#id10" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">~</span> <span class="n">exponential</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rate_parameterization</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="gamma">
<h4>Gamma<a class="headerlink" href="#gamma" title="Link to this heading"></a></h4>
<p>The function for assigning a gamma (<code class="docutils literal notranslate"><span class="pre">gamma</span></code>) distribution to a variable has five parameters:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">n</span></code> (integer, optional): Number of samples to draw (samples are i.i.d.). Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nr</span></code> (integer, optional): Number of replicates to draw per sample. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">shape</span></code> (positive real, required): Shape of distribution.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">scale</span></code> (positive real, required): Scale (or rate) of distribution.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">rate_parameterization</span></code> (string boolean, optional): Whether the value passed in <code class="docutils literal notranslate"><span class="pre">scale</span></code> is the distribution’s rate. Defaults to “false”.</div>
</div>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><strong>Example command.</strong> Specifying two samples of a twice replicated gamma-distributed (shape <span class="math notranslate nohighlight">\(k=10.0\)</span>, scale <span class="math notranslate nohighlight">\(\theta=1.0\)</span>) random variable <span class="math notranslate nohighlight">\(x\)</span>.</span><a class="headerlink" href="#id11" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">~</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="normal">
<h4>Normal<a class="headerlink" href="#normal" title="Link to this heading"></a></h4>
<p>The function for assigning a normal (<code class="docutils literal notranslate"><span class="pre">normal</span></code>) distribution to a variable has four parameters:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">n</span></code> (integer, optional): Number of samples to draw (samples are i.i.d.). Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nr</span></code> (integer, optional): Number of replicates to draw per sample. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">mean</span></code> (real, required): Mean (location) of distribution.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sd</span></code> (positive real, required): Standard deviation (scale) of distribution.</div>
</div>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><strong>Example command.</strong> Specifying two samples of a twice replicated normally (mean <span class="math notranslate nohighlight">\(\mu=0.0\)</span>, standard deviation <span class="math notranslate nohighlight">\(\sigma=1.0\)</span>) distributed random variable <span class="math notranslate nohighlight">\(x\)</span>.</span><a class="headerlink" href="#id12" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">~</span> <span class="n">normal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="log-normal">
<h4>Log-normal<a class="headerlink" href="#log-normal" title="Link to this heading"></a></h4>
<p>The function for assigning a log-normal (<code class="docutils literal notranslate"><span class="pre">lognormal</span></code>) distribution to a variable has five parameters:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">n</span></code> (integer, optional): Number of samples to draw (samples are i.i.d.). Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nr</span></code> (integer, optional): Number of replicates to draw per sample. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">mean</span></code> (real, required): Mean (location) of distribution.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sd</span></code> (positive real, required): Standard deviation (scale) of distribution.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">log_space</span></code> (string boolean, optional): Whether the value of <code class="docutils literal notranslate"><span class="pre">mean</span></code> is in log-space. Defaults to “true”.</div>
</div>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text"><strong>Example command.</strong> Specifying two samples of a twice replicated log-normally (mean log(<span class="math notranslate nohighlight">\(\mu)=-3.25\)</span>, standard deviation <span class="math notranslate nohighlight">\(\sigma=0.25\)</span>) distributed random variable <span class="math notranslate nohighlight">\(x\)</span>.</span><a class="headerlink" href="#id13" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">~</span> <span class="n">lognormal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mean</span><span class="o">=-</span><span class="mf">3.25</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="tree-distributions">
<h3>Tree distributions<a class="headerlink" href="#tree-distributions" title="Link to this heading"></a></h3>
<p>Phylogenetic tree stochastic nodes can be added to a model’s DAG using tree distributions.
At the moment, PhyloJunction comes with one tree distribution that produce a variety of tree types.</p>
<section id="discrete-sse">
<h4>Discrete SSE<a class="headerlink" href="#discrete-sse" title="Link to this heading"></a></h4>
<p>Discrete SSE (<code class="docutils literal notranslate"><span class="pre">discrete_sse</span></code>) stands for discrete state-dependent speciation and extinction process, a general model that includes many popular special cases documented below.</p>
<p><span class="underline">Rate types</span></p>
<p>The implementation and usage of <code class="docutils literal notranslate"><span class="pre">discrete_sse</span></code> in PhyloJunction is very flexible and takes inspiration from Tim Vaughan’s great <a class="reference external" href="https://tgvaughan.github.io/remaster/" rel="noopener noreferrer" target="_blank">ReMASTER</a> simulator program: a model with any number of rates of whatever types may be specified.
Of course, this flexibility comes at the price of user responsibility!</p>
<p>SSE rates are added to a DAG by passing deterministic function <code class="docutils literal notranslate"><span class="pre">sse_rate</span></code> a stochastic or constant node containing a rate’s value (the value can also be passed directly):</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text"><strong>Script excerpt 1.</strong> Command in <em>phylojunction</em> to add a birth rate (deterministic node) to the DAG.</span><a class="headerlink" href="#id14" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">birth_rate</span> <span class="o">~</span> <span class="n">exponential</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">det_birth_rate</span> <span class="o">:=</span> <span class="n">sse_rate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lambda&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">birth_rate</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;speciation&quot;</span><span class="p">)</span>

<span class="c1"># alternatively, one could pass values directly to sse_rate()</span>
<span class="c1"># det_birth_rate := sse_rate(name=&quot;lambda&quot;, value=[0.95, 1.05], event=&quot;speciation&quot;)</span>
</pre></div>
</div>
</div>
<p>Parameters for <code class="docutils literal notranslate"><span class="pre">sse_rate</span></code> include:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">name</span></code> (string, required): The name of the rate parameter. Not particularly critical other than for printing sensical messages to the screen, when using the GUI. The argument to <code class="docutils literal notranslate"><span class="pre">name</span></code> does not have to match anything else in the model, and can in practice be any string enclosed in double quotes.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">value</span></code> (positive real, required): The rate value. This parameter can also take the name of other nodes in the DAG (in which case the value of those nodes are extracted and used).</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">event</span></code> (string, required): A string specifying the rate type (see below).</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">epoch</span></code> (positive integer, optional): Integer specifying the epoch to which this rate applies. See more in the “Time-heterogeneity” section below. Defaults to 1.</div>
</div>
<div class="line-block">
<div class="line">Arguments for the <code class="docutils literal notranslate"><span class="pre">event</span></code> parameter should be enclosed in double quotes and can be:</div>
</div>
<blockquote>
<div><ol class="lowerroman simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;speciation&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;w_speciation&quot;</span></code> for within-state birth rates;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;b_speciation&quot;</span></code> for between-state birth rates;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;asym_speciation&quot;</span></code> for asymmetric birth rates;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;extinction&quot;</span></code> for extinction rates;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;transition&quot;</span></code> for anagenetic transition rates;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;anc_sampling&quot;</span></code> for ancestor sampling (e.g., “fossilization”) rates.</p></li>
</ol>
</div></blockquote>
</div></blockquote>
<p><span class="underline">Sampling probabilities</span></p>
<p>The discrete SSE model in PhyloJunction supports not only state-dependent rates, but also state-dependent sampling probabilities.
Specifying SSE probabilities can be done like so:</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text"><strong>Script excerpt 2.</strong> Command in <em>phylojunction</em> to add a sampling probability parameter (deterministic node) to the DAG.</span><a class="headerlink" href="#id15" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">det_sampling_prob</span> <span class="o">:=</span> <span class="n">sse_prob</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># by setting the value to 1.0, we assume complete sampling!</span>
</pre></div>
</div>
</div>
<p>The parameters for <code class="docutils literal notranslate"><span class="pre">sse_prob</span></code> are:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">name</span></code> (string, required): The name of the probability parameter. Behaves the same as the name of SSE rate parameters.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">value</span></code> (real between 0.0 and 1.0, required): The probability value. As with SSE rates, this parameter can also take the name of DAG nodes that hold probability values.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">state</span></code> (positive integer starting at 0, optional): This integer represents the state to which the probability is associated. Defaults to 0.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">epoch</span></code> (positive integer, optional): Integer specifying the epoch to which this probability applies. See more in the “Time-heterogeneity” section below. Defaults to 1.</div>
</div>
</div></blockquote>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">state</span></code> parameter defaults to 0, and is the state value used in non-state-dependent tree models, like the Yule or birth-death models.</p>
<p><span class="underline">The SSE stash (and time-heterogeneity)</span></p>
<p>Before <code class="docutils literal notranslate"><span class="pre">discrete_sse</span></code> can be assigned as the tree distribution to a DAG stochastic node, state-dependent rate and probability parameters must be stashed together and combined with some more information.
This is accomplished with deterministic function <code class="docutils literal notranslate"><span class="pre">sse_stash</span></code>, whose parameters are:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">flat_rate_mat</span></code> (string vector, required): A vector (deterministic) DAG node names holding the objects created with <code class="docutils literal notranslate"><span class="pre">sse_rate</span></code>. DAG node names do not have to appear in any specific order.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">flat_prob_mat</span></code> (string vector, required): A vector (deterministic) DAG node names holding the objects created with <code class="docutils literal notranslate"><span class="pre">sse_prob</span></code>. DAG node names do not have to appear in any specific order.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">n_states</span></code> (positive integer, optional): How many states the SSE process has. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">n_epochs</span></code> (positive integer, optional): How many epochs characterize the skyline of the SSE process. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">seed_age</span></code> (positive real, optional): The age of the node at which the SSE process starts (either the origin or root node). This parameter must receive an argument if parameters are time-heterogeneous, and it must match the value given to <code class="docutils literal notranslate"><span class="pre">stop_value</span></code> when specifying <code class="docutils literal notranslate"><span class="pre">discrete_sse</span></code> with <code class="docutils literal notranslate"><span class="pre">stop=&quot;age&quot;</span></code> (see more below).</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">epoch_age_ends</span></code> (positive real vector, optional): The age of the ends of each epoch (i.e., the “younger” limit of each epoch, measured as an age), going from the oldest to the youngest epoch. The end of the youngest epoch (which contains the present) should be ommitted as it is added by default. The number of provided age ends should thus be the number of epochs (in <code class="docutils literal notranslate"><span class="pre">n_epochs</span></code>) minus one. Defaults to [0.0].</div>
</div>
</div></blockquote>
<p>The discrete SSE model in PhyloJunction is a “skyline” model, that is, it allows both state-dependent rates and parameters to vary over time (i.e., to be time-heterogeneous).
In the presence of time-heterogeneity, these parameters are assumed to vary according to a user-defined piecewise constant function (this is coded into the model via the <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">epoch</span></code> parameters of <code class="docutils literal notranslate"><span class="pre">sse_rate</span></code> and <code class="docutils literal notranslate"><span class="pre">sse_prob</span></code>).
The limits of each “piece” of that function are given by the argument to <code class="docutils literal notranslate"><span class="pre">epoch_age_ends</span></code> (see above).</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text"><strong>Script excerpt 3.</strong> Command in <em>phylojunction</em> to organize rate and probability parameters into a stash (a deterministic node in the DAG).</span><a class="headerlink" href="#id16" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">det_birth_rate1</span> <span class="o">:=</span> <span class="n">sse_rate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lambda1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;speciation&quot;</span><span class="p">)</span>
<span class="n">det_birth_rate2</span> <span class="o">:=</span> <span class="n">sse_rate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;lambda2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;speciation&quot;</span><span class="p">)</span>

<span class="n">stash</span> <span class="o">:=</span> <span class="n">sse_stash</span><span class="p">(</span><span class="n">flat_rate_mat</span><span class="o">=</span><span class="p">[</span><span class="n">det_birth_rate1</span><span class="p">,</span> <span class="n">det_birth_rate2</span><span class="p">],</span> <span class="n">n_epochs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">seed_age</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">epoch_age_ends</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
<span class="c1"># there are two epochs, the oldest one ends at age 1.0, the youngest one ends at the present</span>
<span class="c1"># the birth-rate of the oldest epoch is 1.0, but that rate doubles in the youngest epoch</span>
</pre></div>
</div>
</div>
<p><span class="underline">The discrete SSE distribution</span></p>
<p>We have seen how to add to the DAG a series of ingredients required by the <code class="docutils literal notranslate"><span class="pre">discrete_sse</span></code> distribution.
The parameters of this function are:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">n</span></code> (integer, optional): Number of samples to draw (samples are i.i.d.). Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nr</span></code> (integer, optional): Number of replicates to draw per sample. Defaults to 1.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">stash</span></code> (string, required): Name of DAG node holding the object created by <code class="docutils literal notranslate"><span class="pre">sse_stash</span></code>.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">start_state</span></code> (positive integer vector starting at 0, required): State at which the process starts for each sample.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">stop</span></code> (string, required): String specifying the simulation stopping condition. If set to <code class="docutils literal notranslate"><span class="pre">&quot;age&quot;</span></code>, the simulation will stop when the origin or root’s age (see parameter <code class="docutils literal notranslate"><span class="pre">origin</span></code>) reaches the value provided in <code class="docutils literal notranslate"><span class="pre">stop_value</span></code>. If set to <code class="docutils literal notranslate"><span class="pre">&quot;size&quot;</span></code>, the simulation will stop when the tree has the number of sampled nodes provided in <code class="docutils literal notranslate"><span class="pre">stop_value</span></code>.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">stop_value</span></code> (positive numeric, required): The stopping condition threshold. If <code class="docutils literal notranslate"><span class="pre">stop=&quot;age&quot;</span></code>, this can be any positive real number. If <code class="docutils literal notranslate"><span class="pre">stop=&quot;size&quot;</span></code>, this can be any positive integer.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">origin</span></code> (string boolean, required): Flag specifying if process starts at origin node (as opposed to the root node). Defaults to “true”.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cond_spn</span></code> (string boolean, optional): Condition the process on at least one speciation event happening. Note that this speciation event may or not be the event represented by the root of the reconstructed tree. Defaults to “false”.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cond_surv</span></code> (string boolean, optional): Condition the process on having at least one surviving lineage at the present moment. This conditioning only makes sense when <code class="docutils literal notranslate"><span class="pre">stop=&quot;age&quot;</span></code>. Defaults to “true”.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cond_obs_both_sides</span></code> (string boolean, optional): Condition the process on having sampled nodes on both sides of the complete tree’s root node. Defaults to “false”.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">min_rec_taxa</span></code> (positive integer, optional): Minimum number of sampled (extant and sampled ancestors) nodes the tree should have. Defaults to 0.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">max_rec_taxa</span></code> (positive integer, optional): Maximum number of sampled (extant and sampled ancestors) nodes the tree should have. Defaults to 1e12.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">abort_at_alive_count</span></code> (positive integer, optional): The count of a tree’s living nodes (irrespective of node sampling) at which point the tree is considered too large for simulation to continue. Trees can grow out of control when <code class="docutils literal notranslate"><span class="pre">stop=&quot;age&quot;</span></code> and one of the rates allows it to grow too big before the stopping condition is met. This parameter can be used to throw away such trees and preventing PhyloJunction from crashing. Defaults to 1e12.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">runtime_limit</span></code> (positive integer, optional): Maximum number of minutes to wait until all samples are drawn. Sampling is aborted at this point. Defaults to 5.</div>
</div>
</div></blockquote>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../installing.html" class="btn btn-neutral float-left" title="Installing and configuring PhyloJunction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../modules.html" class="btn btn-neutral float-right" title="phylojunction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Fabio K. Mendes.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>